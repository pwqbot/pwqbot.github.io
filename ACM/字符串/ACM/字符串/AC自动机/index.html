<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>AC自动机 | qwqbot</title><meta name="author" content="qwqbot"><meta name="copyright" content="qwqbot"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="模式匹配&#x2F;fail树上操作&#x2F;DP">
<meta property="og:type" content="article">
<meta property="og:title" content="AC自动机">
<meta property="og:url" content="http://qwqbot.com/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/index.html">
<meta property="og:site_name" content="qwqbot">
<meta property="og:description" content="模式匹配&#x2F;fail树上操作&#x2F;DP">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Sufjan%20Stevens_Carrie&Lowell.jpg">
<meta property="article:published_time" content="2021-04-17T02:50:52.365Z">
<meta property="article:modified_time" content="2021-05-17T14:19:30.000Z">
<meta property="article:author" content="qwqbot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Sufjan%20Stevens_Carrie&Lowell.jpg"><link rel="shortcut icon" href="/img/qwq_circle2.jpg"><link rel="canonical" href="http://qwqbot.com/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/16.png"/><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-17 22:19:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/qwq_circle2.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Sufjan%20Stevens_Carrie&amp;Lowell.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">qwqbot</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">AC自动机</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-17T02:50:52.365Z" title="发表于 2021-04-17 10:50:52">2021-04-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-17T14:19:30.000Z" title="更新于 2021-05-17 22:19:30">2021-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ACM/">ACM</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>AC自动机</h1>
<p>用来解决多个模式串匹配一个文本串的问题.</p>
<p>首先建一个字典树, 然后对每个前缀状态维护一个 <code>fail</code>指针. <code>fail</code>指针就是KMP中的前缀函数, 只不过是多模的, 所以它可能是指向其他模式串的前缀.</p>
<blockquote>
<p>学会了KMP+字典树 就能很容易的理解AC自动机了</p>
</blockquote>
<ul>
<li>
<p><code>fail</code>指针</p>
<p><code>fail </code>指针 指向的终点字符串, 是 当前字符串的 最长 严格后缀.</p>
<p>比如这里 4 的<code>fail</code>指针指向 7.</p>
<p>当前字符串的下一个匹配失配了, 那就转移到 <code>fail</code> 指向的字符串上面去继续尝试.</p>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201119221916396.png" alt="image-20201124151434307" style="zoom: 33%;" />
</li>
<li>
<p>构建 <code>fail</code> 指针</p>
<p>和 <code>kmp</code> 的过程类似.</p>
<p>对于当前要搭建 <code>fail</code> 指针的结点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> , 先看其父结点的 <code>fail</code> 指针指向的结点的儿子 能不能和自己匹配</p>
<ul>
<li>
<p>如果可以,  当前结点的 <code>fail</code> 指针指向该儿子.</p>
</li>
<li>
<p>如果不可以, 往前递归 <code>fail</code> 指针, 直到跳到的字符串的儿子存在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> , 或者最终跳到根结点.</p>
</li>
</ul>
<p>但是这样做其实效率很低. 先搞明白我们究竟在干什么.</p>
<p>实际上一直往前 <code>fail</code> , 得到的是最开始的字符串的一个递减的后缀集合.</p>
<p>我们想在这个集合里面找到某个后缀的儿子中存在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>.</p>
<p>举个例子, 比如当前字符串为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><mi>b</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">dabc e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 是当前遍历到的结点.</p>
<p>按照过程, 从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 的父亲, 也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> 往前跳 <code>fail</code>,   假设 <code>fail</code> 指针经过的后缀为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mi>c</mi><mo separator="true">,</mo><mi>b</mi><mi>c</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">abc,bc,c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span></span></span></span>.</p>
<p>假设这时候只有最后一个后缀 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> 有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 儿子, 那么为了加速这个查找过程, 可以把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mi>c</mi><mo separator="true">,</mo><mi>b</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">abc,bc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span></span></span></span> 不存在的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 儿子指向 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 儿子.</p>
<p>这样查询 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">abc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal">c</span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 儿子的时候就能直接找到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 儿子了.</p>
<p>因为后缀长度是递减的. 所以可以用一个 <code>bfs</code>来完成这个过程.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">        q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">            <span class="keyword">if</span> (v) </span><br><span class="line">            &#123;</span><br><span class="line">                fail[v] = trie[fail[u]][i]; <span class="comment">// 儿子的fail</span></span><br><span class="line">                q.push(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                v = trie[fail[u]][i]; <span class="comment">// 不存在该儿子, 往前指</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查询</p>
<p>现在有了 <code>fail</code> 指针. 在字典树上前缀匹配, 如果在当前点失配. 即当前点的儿子中没有现在遍历到的字符, 那么就可以借助当前点的 <code>fail</code>指针往回跳.</p>
<p>但是这里查询不是一直走, 直到不匹配才使用fail指针. 因为是多模匹配, 所以每走一步, 都要用 <code>fail</code>查询一遍.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">        u = trie[u][p];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = u; v; v = fail[v])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 不同题目不同做法</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201119231237503.png" alt="image-20201119231237503" style="zoom:67%;" />
<h1>题目</h1>
<ul>
<li>
<p>模板</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> trie[maxn][<span class="number">30</span>], fail[maxn];</span><br><span class="line">    <span class="keyword">int</span> sz[maxn];</span><br><span class="line">    <span class="keyword">int</span> vis[maxn]; <span class="comment">// 结点经过次数</span></span><br><span class="line">    <span class="keyword">int</span> MP[maxn]; <span class="comment">// 模式串相同时用的映射</span></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>, csz = <span class="number">30</span>; <span class="comment">// 字典树结点号;字符集大小</span></span><br><span class="line">	<span class="keyword">int</span> in[maxn]; <span class="comment">// topu用的入度</span></span><br><span class="line">    </span><br><span class="line">    AC()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// msz(trie);</span></span><br><span class="line">        <span class="comment">// msz(fail);</span></span><br><span class="line">        <span class="comment">// msz(sz);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        fill(fail, fail + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(sz, sz + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(vis, vis + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) rep(j, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            trie[i][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ctn</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_node</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) trie[cnt][i] = <span class="number">0</span>;</span><br><span class="line">        sz[cnt] = fail[cnt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">                trie[root][p] = get_node();</span><br><span class="line">            root = trie[root][p];</span><br><span class="line">        &#125; </span><br><span class="line">        MP[id] = sz[root]; <span class="comment">//叶结点个数增加.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">                <span class="keyword">if</span> (v)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v] = trie[fail[u]][i];</span><br><span class="line">                    q.push(v);</span><br><span class="line">                    in[fail[v]]++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    v = trie[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            u = trie[u][p];</span><br><span class="line">            vis[u]++;</span><br><span class="line">            <span class="comment">// for (int v = u; v; v = fail[v])</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     for (auto to : sz[v])</span></span><br><span class="line">            <span class="comment">//         vis[to]++;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">topu</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) <span class="keyword">if</span> (!in[i])</span><br><span class="line">            q.push(i);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            vis[fail[u]] += vis[u];</span><br><span class="line">            in[fail[u]]--;</span><br><span class="line">            <span class="keyword">if</span> (!in[fail[u]])</span><br><span class="line">                q.push(fail[u]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="模式匹配">模式匹配</h2>
<h3 id="洛谷-ac自动机模板">洛谷 ac自动机模板</h3>
<p>三道题,可以熟悉一下ac自动机.</p>
<h4 id="P3808">P3808</h4>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210510202557883.png" alt="image-20210510202557883" style="zoom:50%;" />
<p>字典树上的结点要记录以终止于此的字符串的个数.</p>
<p>注意查询一次过后要设成-1来避免重复查询.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = s[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        u = trie[u][p];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = u; v &amp;&amp; sz[v] != <span class="number">-1</span>; v = fail[v])</span><br><span class="line">        &#123;</span><br><span class="line">            cnt += sz[v];</span><br><span class="line">            sz[v] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="P3796">P3796</h4>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210510202618096.png" alt="image-20210510202618096" style="zoom:50%;" />
<p>字典树上的结点记录终止于它的字符串的编号.</p>
<p>统计出现多次, 所以不要设置为-1.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> vis[maxn]; <span class="comment">// 记录每个模式串被访问的次数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">        u = trie[u][p];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = u; v; v = fail[v])</span><br><span class="line">        &#123;</span><br><span class="line">            vis[sz[v]]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="P5357">P5357</h4>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210510202700990.png" alt="image-20210510202700990" style="zoom:50%;" />
<p>把上题代码套进来 t 了.</p>
<p>这题有两个坑点.</p>
<ol>
<li>
<p>模式串会重复出现</p>
<p>插入时要做一个映射</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">        <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">            trie[root][p] = ++cnt;</span><br><span class="line">        root = trie[root][p];</span><br><span class="line">    &#125;  </span><br><span class="line">    MP[id] = root; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>超时</p>
<p>查询的时候不能暴力跳<code>fail</code>. 先在当前点累计, 然后最后再累加回去. 加的时候要按照构建 <code>fail</code> 的边的拓扑序.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> in[maxn]; <span class="comment">// topu用的入度</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">        q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">            <span class="keyword">if</span> (v)</span><br><span class="line">            &#123;</span><br><span class="line">                fail[v] = trie[fail[u]][i];</span><br><span class="line">                q.push(v);</span><br><span class="line">                in[fail[v]]++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                v = trie[fail[u]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> vis[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">        u = trie[u][p];</span><br><span class="line">        vis[u]++;</span><br><span class="line">        <span class="comment">// for (int v = u; v; v = fail[v])</span></span><br><span class="line">        <span class="comment">// &#123;</span></span><br><span class="line">        <span class="comment">//     for (auto to : sz[v])</span></span><br><span class="line">        <span class="comment">//         vis[to]++;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">topu</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    rep(i, <span class="number">1</span>, cnt) <span class="keyword">if</span> (!in[i])</span><br><span class="line">        q.push(i);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[fail[u]] += vis[u];</span><br><span class="line">        in[fail[u]]--;</span><br><span class="line">        <span class="keyword">if</span> (!in[fail[u]])</span><br><span class="line">            q.push(fail[u]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="洛谷-P2444-POI2000-病毒trie树上找环">洛谷 P2444 [POI2000]病毒	trie树上找环</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210511205108214.png" alt="image-20210511205108214" style="zoom:50%;" />
<ul>
<li>
<p>分析</p>
<p>对禁止串建自动机.</p>
<p>构造安全代码的时候, 在自动机上不能经过禁止的状态.</p>
<p>首先删掉所有的禁止状态. 然后在剩下的点中找环即可</p>
</li>
<li>
<p>代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// ----------------check here before submitting your code--------------------------------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QWQ1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">8e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// -------------------------------------check here before submitting your code-----------</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">2e9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> INF64 = <span class="number">4e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG(qwq...) fprintf(stderr, qwq)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(x, y, z) for (int(x) = int(y); int(x) &lt;= int(z); x++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(x, y, z) for (int(x) = int(y); int(x) &gt;= int(z); x--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min3(x, y, z) min((x), min((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max3(x, y, z) max((x), max((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cb complex<span class="meta-string">&lt;double&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) ((-(x)) &amp; (x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msz(a) memset(a, 0, sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msm(a) memset(a, -1, sizeof(a))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//const int g1 = 3;</span></span><br><span class="line"><span class="comment">//const int g2 = 332748118;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1ll</span> * x * y % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x + y &gt;= mod ? x + y - mod : x + y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x - y &lt; <span class="number">0</span> ? x - y + mod : x - y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = mul(ans, a);</span><br><span class="line">        a = mul(a, a);</span><br><span class="line">        b /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> trie[maxn][<span class="number">30</span>], fail[maxn];</span><br><span class="line">    <span class="keyword">bool</span> sz[maxn];</span><br><span class="line">    <span class="keyword">int</span> MP[maxn];</span><br><span class="line">    <span class="keyword">int</span> n1[maxn], n2[maxn];</span><br><span class="line">    <span class="keyword">int</span> mp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>, csz = <span class="number">2</span>; <span class="comment">// 字典树标号, 字符集大小</span></span><br><span class="line"></span><br><span class="line">    AC()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// msz(trie);</span></span><br><span class="line">        <span class="comment">// msz(fail);</span></span><br><span class="line">        <span class="comment">// msz(vis);</span></span><br><span class="line">        <span class="comment">// msz(sz);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        fill(fail, fail + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// fill(sz, sz + cnt + 1, 0);</span></span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) rep(j, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            trie[i][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ctn</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_node</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) trie[cnt][i] = <span class="number">0</span>;</span><br><span class="line">        sz[cnt] = fail[cnt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">                trie[root][p] = get_node();</span><br><span class="line">            root = trie[root][p];</span><br><span class="line">        &#125;</span><br><span class="line">        sz[root] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">                <span class="keyword">if</span> (v)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v] = trie[fail[u]][i];</span><br><span class="line">                    q.push(v);</span><br><span class="line">                    sz[v] |= sz[fail[v]];  <span class="comment">// 传递禁止状态</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    v = trie[fail[u]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> vis[maxn];</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">find_circle</span><span class="params">(<span class="keyword">int</span> root = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        vis[root] = <span class="number">1</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> v = trie[root][i];</span><br><span class="line">            <span class="keyword">if</span> (sz[v] || vis[v] == <span class="number">2</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] == <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (find_circle(v))</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[root] = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    <span class="comment">//freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;out.txt&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    <span class="keyword">int</span> st_cl = clock();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    AC ac;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    rep(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> s;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        ac.insert(s, i);</span><br><span class="line">    &#125;</span><br><span class="line">    ac.build_fail();</span><br><span class="line">    <span class="keyword">if</span> (ac.find_circle())</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;TAK&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;NIE&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    LOG(<span class="string">&quot;Time: %dms\n&quot;</span>, <span class="keyword">int</span>((clock() - st_cl) / (<span class="keyword">double</span>)CLOCKS_PER_SEC * <span class="number">1000</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="CF-1202-E-You-Are-Given-Some-Strings-翻转字符串">CF 1202 E. You Are Given Some Strings...      翻转字符串</h3>
<p>https://codeforces.com/contest/1202/problem/E</p>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210511213407413.png" alt="image-20210511213407413" style="zoom:50%;" />
<ul>
<li>
<p>分析</p>
<p>首先肯定不能暴力拼接统计的🔵 .</p>
<p>如果串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><mo>+</mo><msub><mi>s</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">s_{i} + s_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 出现, 那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">s_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 出现的位置(指最后一个字符) 就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 出现的位置加上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">s_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 的长度.</p>
<p>于是对串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> 的每个位置, 记录两个数组.</p>
<p>一个是终止在当前位置的模式串的个数. 一个是终止位置减去长度之后在当前位置的模式串的个数.</p>
<p>把两个数组对应位置相乘累加就可以得到最后的答案.</p>
<p>求第一个数组可以不用跳 <code>fail</code> , 直接把出现次数沿着<code>fail</code> 链累加起来就行了.</p>
<p>但是求第二个数组就必须跳fail, 因为要减去的长度都不一样.</p>
<p>于是就 tle 了.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">        u = trie[u][p];</span><br><span class="line">        <span class="comment">// vis[u]++;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v = u; v; v = fail[v])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sz[v])</span><br><span class="line">            &#123;</span><br><span class="line">                n1[i] += sz[v];</span><br><span class="line">                n2[i - dep[v]] += sz[v];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        ans += <span class="number">1ll</span> * n1[i] * n2[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改一下思路, 第二个数组是开始于当前位置的模式串的个数. 但是ac自动机只能求终止于当前位置的字符串的个数.</p>
<p>要求开始的, 把串翻转一下就行了. 这样得建两个自动机.</p>
</li>
<li>
<p>代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// ----------------check here before submitting your code--------------------------------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QWQ1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">8e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// -------------------------------------check here before submitting your code-----------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG(qwq...) fprintf(stderr, qwq)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(x, y, z) for (int(x) = int(y); int(x) &lt;= int(z); x++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(x, y, z) for (int(x) = int(y); int(x) &gt;= int(z); x--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min3(x, y, z) min((x), min((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max3(x, y, z) max((x), max((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cb complex<span class="meta-string">&lt;double&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iinf 2e9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> linf 9e18</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) ((-(x)) &amp; (x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msz(a) memset(a, 0, sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msm(a) memset(a, -1, sizeof(a))</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="comment">//const int g1 = 3;</span></span><br><span class="line"><span class="comment">//const int g2 = 332748118;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1ll</span> * x * y % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x + y &gt;= mod ? x + y - mod : x + y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x - y &lt; <span class="number">0</span> ? x - y + mod : x - y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = mul(ans, a);</span><br><span class="line">        a = mul(a, a);</span><br><span class="line">        b /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> trie[maxn][<span class="number">30</span>], fail[maxn];</span><br><span class="line">    <span class="keyword">int</span> sz[maxn];</span><br><span class="line">    <span class="keyword">int</span> MP[maxn];</span><br><span class="line">    <span class="keyword">int</span> dep[maxn];</span><br><span class="line">    <span class="keyword">int</span> n1[maxn], n2[maxn];</span><br><span class="line">    <span class="keyword">int</span> mp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>, csz = <span class="number">30</span>; <span class="comment">// 字典树标号, 字符集大小</span></span><br><span class="line"></span><br><span class="line">    AC()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// msz(trie);</span></span><br><span class="line">        <span class="comment">// msz(fail);</span></span><br><span class="line">        <span class="comment">// msz(vis);</span></span><br><span class="line">        <span class="comment">// msz(sz);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        fill(fail, fail + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// fill(sz, sz + cnt + 1, 0);</span></span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) rep(j, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            trie[i][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ctn</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_node</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) trie[cnt][i] = <span class="number">0</span>;</span><br><span class="line">        sz[cnt] = fail[cnt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">                trie[root][p] = get_node();</span><br><span class="line">            dep[trie[root][p]] = dep[root] + <span class="number">1</span>;</span><br><span class="line">            root = trie[root][p];</span><br><span class="line">        &#125;</span><br><span class="line">        sz[root]++;</span><br><span class="line">        MP[id] = root; <span class="comment">//叶结点个数增加.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> in[maxn]; <span class="comment">// topu用的入度</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">                <span class="keyword">if</span> (v)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v] = trie[fail[u]][i];</span><br><span class="line">                    q.push(v);</span><br><span class="line">                    in[fail[v]]++;</span><br><span class="line">                    sz[v] += sz[fail[v]];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    v = trie[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> vis[maxn];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            u = trie[u][p];</span><br><span class="line">            vis[i] += sz[u];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    <span class="comment">//freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;out.txt&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    <span class="keyword">int</span> st_cl = clock();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    AC ac1, ac2;</span><br><span class="line">    <span class="built_in">string</span> t;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; t;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    rep(i, <span class="number">1</span>, n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> s;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        ac1.insert(s, i);</span><br><span class="line">        reverse(s.begin(), s.end());</span><br><span class="line">        ac2.insert(s, i);</span><br><span class="line">    &#125;</span><br><span class="line">    ac2.build_fail();</span><br><span class="line">    ac1.build_fail();</span><br><span class="line">    ac1.query(t);</span><br><span class="line">    reverse(t.begin(), t.end());</span><br><span class="line">    ac2.query(t);</span><br><span class="line">    ll res = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, t.size() - <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// debug(ac1.vis[i]);</span></span><br><span class="line">        <span class="comment">// debug(ac2.vis[i]);</span></span><br><span class="line">        res += <span class="number">1ll</span> * ac1.vis[i] * ac2.vis[t.size() - <span class="number">2</span> - i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    LOG(<span class="string">&quot;Time: %dms\n&quot;</span>, <span class="keyword">int</span>((clock() - st_cl) / (<span class="keyword">double</span>)CLOCKS_PER_SEC * <span class="number">1000</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="AC自动机fail树上建可持久化线段树">AC自动机fail树上建可持久化线段树</h2>
<p>根据 <code>fail</code> 指针我们可以反向建立一颗 <code>fail</code> 树.</p>
<ul>
<li>
<p><code>fail</code> 树的性质</p>
<ol>
<li>每个点都是一个前缀</li>
<li>一个点的父亲是它和其他前缀所能匹配的最大严格后缀.</li>
<li>子树中的所有点对应的字符串都包含根的字符串.</li>
<li>一个点到根的路径上的路径是它的一个长度递减的后缀集合.</li>
</ol>
</li>
</ul>
<h3 id="洛谷-P2414-NOI2011-阿狸的打字机-字典树上dfs-fail树区间查询">洛谷 P2414 [NOI2011] 阿狸的打字机       字典树上dfs+fail树区间查询</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210510213245926.png" alt="image-20210510213245926" style="zoom:50%;" />
<ul>
<li>
<p>题意</p>
<p>给一组模式串. 询问 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> 次, 每次询问 模式串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 在模式串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 中出现了多少次.</p>
</li>
<li>
<p>分析</p>
<p>对于字典树上的两个串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>. 求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 中出现多少次.</p>
<p>等价于求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 这一个串上的所有点, 有多少个点的 <code>fail</code> 指针间接或者直接指向 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 串的最后一个结点.</p>
<p>根据 <code>fail</code> 边反向搭建 <code>fail</code> 树.</p>
<p>问题转换为 <strong>统计 <code>fail</code> 树中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 的子树中有多少个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 的点.</strong></p>
<p>子树统计可以转换为 <code>dfs</code> 序的区间统计.</p>
<p>但是这里有多次询问, 不能每次都暴力统计.</p>
<p>考虑到一个字符串在字典树上是一条路径, 对字典树进行 <code>dfs</code>, 进入时给当前点 <code>+1</code>, 退出时 <code>-1</code>, 这样可以保证只有当前路径全是 <code>1</code>.</p>
<p><code>dfs</code> 到某个 <code>y</code> 的终止结点时, 查询关于它的所有询问的 <code>x</code>, 求出子树区间和即可(用树状数组维护).</p>
</li>
<li>
<p>细节</p>
<ol>
<li>这里搭建字典树要手动模拟一下它的过程.</li>
<li>字典树 <code>build_fail</code> 之后原来的 <code>trie</code> 树就乱了, 所以要保存好初始的<code>trie</code> 用于后面的 <code>dfs</code></li>
</ol>
</li>
<li>
<p>代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// ----------------check here before submitting your code--------------------------------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// -------------------------------------check here before submitting your code-----------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG(qwq...) fprintf(stderr, qwq)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(x, y, z) for (int(x) = int(y); int(x) &lt;= int(z); x++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(x, y, z) for (int(x) = int(y); int(x) &gt;= int(z); x--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min3(x, y, z) min((x), min((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max3(x, y, z) max((x), max((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cb complex<span class="meta-string">&lt;double&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iinf 2e9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> linf 9e18</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) ((-(x)) &amp; (x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msz(a) memset(a, 0, sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msm(a) memset(a, -1, sizeof(a))</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="comment">//const int g1 = 3;</span></span><br><span class="line"><span class="comment">//const int g2 = 332748118;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setmin</span><span class="params">(T &amp;a, T b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &lt; a)</span><br><span class="line">        a = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1ll</span> * x * y % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x + y &gt;= mod ? x + y - mod : x + y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x - y &lt; <span class="number">0</span> ? x - y + mod : x - y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = mul(ans, a);</span><br><span class="line">        a = mul(a, a);</span><br><span class="line">        b /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; q[maxn];</span><br><span class="line"><span class="keyword">int</span> ans[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> trie[maxn][<span class="number">30</span>], fail[maxn];</span><br><span class="line">    <span class="keyword">int</span> trie2[maxn][<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">int</span> sz[maxn];</span><br><span class="line">    <span class="keyword">int</span> vis[maxn];            <span class="comment">// 结点经过次数</span></span><br><span class="line">    <span class="keyword">int</span> MP[maxn];             <span class="comment">// 模式串相同时用的映射</span></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>, csz = <span class="number">30</span>;    <span class="comment">// 字典树结点号;字符集大小</span></span><br><span class="line">    <span class="keyword">int</span> dfn[maxn], low[maxn]; <span class="comment">// topu用的入度</span></span><br><span class="line">    <span class="keyword">int</span> dn = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> fa[maxn];</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; g[maxn];</span><br><span class="line">    AC()</span><br><span class="line">    &#123;</span><br><span class="line">        msz(trie);</span><br><span class="line">        msz(fail);</span><br><span class="line">        msz(sz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        fill(fail, fail + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(sz, sz + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(vis, vis + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) rep(j, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            trie[i][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ctn</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">back</span><span class="params">(<span class="keyword">int</span> &amp;root)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        root = fa[root];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">p</span><span class="params">(<span class="keyword">int</span> root, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!sz[root])</span><br><span class="line">            sz[root] = id;</span><br><span class="line">        MP[id] = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;root, <span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = ctn(c);</span><br><span class="line">        <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">        &#123;</span><br><span class="line">            trie[root][p] = ++cnt;</span><br><span class="line">            trie2[root][p] = cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        fa[trie[root][p]] = root;</span><br><span class="line">        root = trie[root][p];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">        &#123;</span><br><span class="line">            g[trie[<span class="number">0</span>][i]].push_back(<span class="number">0</span>);</span><br><span class="line">            g[<span class="number">0</span>].push_back(trie[<span class="number">0</span>][i]);</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">                <span class="keyword">if</span> (v)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v] = trie[fail[u]][i];</span><br><span class="line">                    q.push(v);</span><br><span class="line">                    g[v].push_back(fail[v]);</span><br><span class="line">                    g[fail[v]].push_back(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    v = trie[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dfn[x] = ++dn;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> to : g[x])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (to == fa)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            dfs1(to, x);</span><br><span class="line">        &#125;</span><br><span class="line">        low[x] = dn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tree[maxn];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &lt; maxn)</span><br><span class="line">        &#123;</span><br><span class="line">            tree[x] += y;</span><br><span class="line">            x += lowbit(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x)</span><br><span class="line">        &#123;</span><br><span class="line">            ans += tree[x];</span><br><span class="line">            x -= lowbit(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        add(dfn[x], <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (sz[x])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> to : q[sz[x]])</span><br><span class="line">            &#123;</span><br><span class="line">                ans[to.first] = sum(low[MP[to.second]]) - sum(dfn[MP[to.second]] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie2[x][i])</span><br><span class="line">            dfs2(trie2[x][i]);</span><br><span class="line">        add(dfn[x], <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ac;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    <span class="comment">//freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;out.txt&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    <span class="keyword">int</span> st_cl = clock();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">            ac.back(root);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s[i] == <span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">            ac.p(root, ++cnt);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ac.insert(root, s[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    ac.build_fail();</span><br><span class="line">    ac.dfs1(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    rep(i, <span class="number">1</span>, m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        q[y].push_back(&#123;i, x&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    ac.dfs2(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    rep(i, <span class="number">1</span>, m) <span class="built_in">cout</span> &lt;&lt; ans[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    LOG(<span class="string">&quot;Time: %dms\n&quot;</span>, <span class="keyword">int</span>((clock() - st_cl) / (<span class="keyword">double</span>)CLOCKS_PER_SEC * <span class="number">1000</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="洛谷-P5840-COCI2015-Divljak-dfs-lca-树上差分">洛谷 P5840 [COCI2015]Divljak     dfs+lca+树上差分</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210511215112242.png" alt="image-20210511215112242" style="zoom:50%;" />
<ul>
<li>
<p>分析</p>
<p>ac自动机是 给一组模式串, 求目标串包含了多少个模式串.</p>
<p>这题是反过来, 给一个模式串, 求一组目标串中有多少个包含了模式串.</p>
<p>把模式串和目标串都加到字典树里.</p>
<p>询问就等价于问 <code>fail</code> 树中, 以模式串最后一个字符为根所在的子树中, 有多少个不同的目标串的点.</p>
<p>好像不太能直接做.</p>
<p>我们按照顺序插入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>.</p>
<p>假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> 在字典树上经过的结点为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>t</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>t</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">t_{1}, t_{2}, \dots, t_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. 那么我们要做的就是 把 <code>fail</code> 树上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∪</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi>f</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cup_{i=1}^{n} f(t_{i})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008664em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mbin">∪</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 都加上1.</p>
<p>这里<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 到根的路径上的所有的点.</p>
<p>使用树论的一个技巧. 把所有点按照其在 <code>fail</code> 树上的 <code>dfs</code> 序排序. 然后每个点到根的路径都加1. 相邻点的 <code>lca</code> 到根的路径减1.</p>
<p>可以用树上差分实现.</p>
</li>
<li>
<p>代码</p>
</li>
</ul>
<h3 id="CF163-E-e-Government-动态修改">CF163 E.e-Government      动态修改</h3>
<p>http://codeforces.com/problemset/problem/163/E</p>
<img src= "/img/loading.gif" data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210516210305058.png" alt="image-20210516210305058" style="zoom:67%;" />
<ul>
<li>
<p>题意</p>
<p>动态插入删除的ac自动机.</p>
<p>询问目标串中出现多少次模式串.</p>
</li>
<li>
<p>分析</p>
<p>在ac自动机中删除一个字符串就是把终止字符所在的子树所有点都减1.</p>
<p>建一个线段树维护一下区间修改即可.</p>
</li>
</ul>
<h3 id="CF547-E-Mike-and-Friends-离线-主席树">CF547 E.Mike and Friends     离线/主席树</h3>
<p>https://codeforces.com/problemset/problem/547/E</p>
<img src= "/img/loading.gif" data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210516211858437.png" alt="image-20210516211858437" style="zoom:50%;" />
<ul>
<li>
<p>题意</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> 个字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> 次询问. 每次询问 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">s_{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>l</mi></msub><mo>−</mo><msub><mi>s</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">s_{l} - s_{r}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 这之间的所有字符串中总共出现了几次.</p>
</li>
<li>
<p>分析</p>
<p>暴力的做法, 先建好字典树, 然后可以把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>l</mi></msub><mo>−</mo><msub><mi>s</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">s_{l} - s_{r}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 经过的点都加上 1. 在 <code>fail</code> 树上求一下<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">s_{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的子树和即可.</p>
<p>稍微优化一点, 可以一次 <code>dfs</code> 实现.</p>
<p>cao！有一个简单的离线做法. 排序所有的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">l-1,r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>. 插入查询…..</p>
<p>cao! 这主席树的做法也太暴力了. 一个字符串插入一个字符当单点修改….</p>
</li>
<li>
<p>代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">  ```</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">### CF1207 G.Indie Album</span><br><span class="line"></span><br><span class="line">https:<span class="comment">//codeforces.com/problemset/problem/1207/G</span></span><br><span class="line"></span><br><span class="line">&lt;img src=<span class="string">&quot;https://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210516214924985.png&quot;</span> alt=<span class="string">&quot;image-20210516214924985&quot;</span> style=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">- 题意</span><br><span class="line"></span><br><span class="line">  两种方式生成字符串.</span><br><span class="line"></span><br><span class="line">  <span class="number">1.</span> 单个字符</span><br><span class="line">  <span class="number">2.</span> 在第 $j$ 个生成的字符串后面加单个字符</span><br><span class="line"></span><br><span class="line">  多次询问, 每次问字符串 $t$ 在字符串 $s_&#123;i&#125;$ 中出现了几次.</span><br><span class="line"></span><br><span class="line">- 分析</span><br><span class="line"></span><br><span class="line">  只要把字符串建出来就和阿狸的打字机差不多了.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### CF1437 G.Death DBMS</span><br><span class="line"></span><br><span class="line">&lt;img src=<span class="string">&quot;https://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210516221606097.png&quot;</span> alt=<span class="string">&quot;image-20210516221606097&quot;</span> style=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">- 题意</span><br><span class="line"></span><br><span class="line">  给目标串, 找到被其包含的最大权值的模式串.</span><br><span class="line"></span><br><span class="line">  动态修改模式串权值.</span><br><span class="line"></span><br><span class="line">- 分析</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">## DP</span><br><span class="line"></span><br><span class="line">### POJ <span class="number">3691</span> Censore 修改禁止字符串</span><br><span class="line"></span><br><span class="line">&lt;img src=<span class="string">&quot;http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210510003025081.png&quot;</span> alt=<span class="string">&quot;image-20210510003025081&quot;</span> style=<span class="string">&quot;zoom:50%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">- 题意</span><br><span class="line"></span><br><span class="line">  修改最少的字符, 使得字符串中不出现给定的模式串.</span><br><span class="line"></span><br><span class="line">- 分析</span><br><span class="line"></span><br><span class="line">  先考虑只有一个禁止串的版本. 设禁止串为$s$. </span><br><span class="line"></span><br><span class="line">  令 $dp[i][j]$ 表示长度为 $i$, 并且此时的后缀和 $s$ 的最大前缀匹配的长度为 $j$ 的代价. </span><br><span class="line"></span><br><span class="line">  状态转移: 先枚举 $i$ 处的字符串, 然后可以转移到 $i<span class="number">-1</span>$ 的前缀匹配. 	</span><br><span class="line"></span><br><span class="line">  用 `kmp` 对 $s$ 预处理一下得到转移长度.</span><br><span class="line"></span><br><span class="line">  然后初始状态的话, 就设置 $dp[i][<span class="number">0</span>] = <span class="number">0</span>$ 和 $dp[i][len(s)] = <span class="number">0x3f3f3f3f3f</span>$;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  考虑多个字符串的版本. </span><br><span class="line"></span><br><span class="line">  对禁止的字符串构建 `fail` 树.</span><br><span class="line"></span><br><span class="line">  令$dp[i][j]$  表示在原字符串的第 $i$ 个位置, 并且当前的匹配状态在字典树的 $j$  号结点的代价.</span><br><span class="line">  </span><br><span class="line">  然后就可以枚举</span><br><span class="line">  </span><br><span class="line">  哦, 这里看来 dp 要向前转移方便.这里的转移是字典树上的转移. </span><br><span class="line">  </span><br><span class="line">  然后得看一下哪些点的代价是正无穷的. 就是对一个点一直fail, 如果路径上有正无穷那这个点也是正无穷. </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">- 代码</span><br><span class="line"></span><br><span class="line">  ``` cpp</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span>;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">55</span>][<span class="number">30</span>];</span><br><span class="line">  <span class="keyword">char</span> t[<span class="number">1005</span>];</span><br><span class="line">  <span class="keyword">char</span> alp[<span class="number">5</span>] = &#123;<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;T&#x27;</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> fail[<span class="number">10005</span>];</span><br><span class="line">  <span class="keyword">int</span> trie[<span class="number">10005</span>][<span class="number">30</span>];</span><br><span class="line">  <span class="keyword">int</span> sz[<span class="number">10005</span>];</span><br><span class="line">  <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span> (!trie[root][s[i] - <span class="string">&#x27;A&#x27;</span>])</span><br><span class="line">              trie[root][s[i] - <span class="string">&#x27;A&#x27;</span>] = ++cnt;</span><br><span class="line">          root = trie[root][s[i] - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      sz[root] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span> (trie[<span class="number">0</span>][alp[i] - <span class="string">&#x27;A&#x27;</span>])</span><br><span class="line">              q.push(trie[<span class="number">0</span>][alp[i] - <span class="string">&#x27;A&#x27;</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> (!q.empty())</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">int</span> v = q.front();</span><br><span class="line">          q.pop();</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span> (trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>])</span><br><span class="line">              &#123;</span><br><span class="line">                  fail[trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>]] = trie[fail[v]][alp[i] - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">                  <span class="keyword">if</span> (sz[trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>]] == <span class="number">0</span>) <span class="comment">// 注意一个点坏了, 那么所有包含它的后缀都坏了</span></span><br><span class="line">                      sz[trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>]] = sz[trie[fail[v]][alp[i] - <span class="string">&#x27;A&#x27;</span>]];</span><br><span class="line">                  q.push(trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>]);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                  trie[v][alp[i] - <span class="string">&#x27;A&#x27;</span>] = trie[fail[v]][alp[i] - <span class="string">&#x27;A&#x27;</span>];</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> dp[<span class="number">1005</span>][<span class="number">2005</span>];</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> n;</span><br><span class="line">      <span class="keyword">int</span> ttt = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) &amp;&amp; n)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s[i]);</span><br><span class="line">              insert(s[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          bfs();</span><br><span class="line">          <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, t);</span><br><span class="line">          <span class="keyword">int</span> m = <span class="built_in">strlen</span>(t);</span><br><span class="line">          <span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">          dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= cnt; k++)</span><br><span class="line">              &#123;</span><br><span class="line">                  <span class="keyword">if</span> (dp[i][k] == <span class="number">0x3f3f3f3f</span>)</span><br><span class="line">                      <span class="keyword">continue</span>;</span><br><span class="line">                  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) <span class="comment">// TCCTCAT</span></span><br><span class="line">                  &#123;</span><br><span class="line">                      <span class="keyword">if</span> (sz[trie[k][alp[j] - <span class="string">&#x27;A&#x27;</span>]] != <span class="number">-1</span>) <span class="comment">// 避开坏点dp</span></span><br><span class="line">                          dp[i + <span class="number">1</span>][trie[k][alp[j] - <span class="string">&#x27;A&#x27;</span>]] = min(dp[i + <span class="number">1</span>][trie[k][alp[j] - <span class="string">&#x27;A&#x27;</span>]], dp[i][k] + (alp[j] != t[i]));</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">int</span> ans = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">              ans = min(ans, dp[m][i]);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Case %d: &quot;</span>, ++ttt);</span><br><span class="line">          <span class="keyword">if</span> (ans == <span class="number">0x3f3f3f3f</span>)</span><br><span class="line">              <span class="built_in">cout</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</span><br><span class="line">          &#123;</span><br><span class="line">              fail[i] = sz[i] = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++)</span><br><span class="line">                  trie[i][j] = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          cnt = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="HDU-2296-Ring-构造字符串得到最大权值">HDU 2296 Ring   构造字符串得到最大权值</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201124150910176.png" alt="image-20201124225402972" style="zoom:50%;" />
<ul>
<li>
<p>分析</p>
<p>同样先考虑单个字符串.</p>
<p>对于单个字符串的情况, 肯定是先填这一个字符串, 然后对下个字母, 应该填能达到最大的后缀匹配前缀的字母.</p>
<p>同样可以用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span> 来表示. 不过这里当$j = $ 匹配串长度的时候要处理一下.</p>
<p>然后考虑多个字符串. 应该是在bfs的时候把代价累加一下就好了.</p>
<p>麻烦的地方在于输出最小字典序.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; v;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">int</span> tr[<span class="number">100005</span>][<span class="number">30</span>], fail[<span class="number">100005</span>];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> val[<span class="number">100005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.size(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">            tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>] = ++cnt;</span><br><span class="line">        root = tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    val[root] = a[id];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> (tr[<span class="number">0</span>][i])</span><br><span class="line">            q.push(tr[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (tr[x][i])</span><br><span class="line">            &#123;</span><br><span class="line">                fail[tr[x][i]] = tr[fail[x]][i];</span><br><span class="line">                val[tr[x][i]] += val[tr[fail[x]][i]];</span><br><span class="line">                q.push(tr[x][i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                tr[x][i] = tr[fail[x]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">105</span>][<span class="number">2005</span>];</span><br><span class="line"><span class="keyword">bool</span> ok[<span class="number">105</span>][<span class="number">2005</span>];</span><br><span class="line"><span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; tra[<span class="number">105</span>][<span class="number">2005</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> n, m;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> s;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">            v.push_back(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">            insert(v[i - <span class="number">1</span>], i);</span><br><span class="line">        bfs();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">                dp[i][j] = <span class="number">-0x3f3f3f3f</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">                    dp[i + <span class="number">1</span>][tr[j][k]] = max(dp[i + <span class="number">1</span>][tr[j][k]], dp[i][j] + val[tr[j][k]]);</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)  <span class="comment">//先找最大值</span></span><br><span class="line">            ans = max(ans, dp[n][j]);</span><br><span class="line">        <span class="keyword">int</span> e = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)  <span class="comment">//找长度最小的</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[i][j] == ans)</span><br><span class="line">                &#123;</span><br><span class="line">                    e = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)  <span class="comment">//ok = 1表示可以转移到最优解</span></span><br><span class="line">            ok[e][j] = dp[e][j] == ans;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = e - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">                    ok[i][j] |= (ok[i + <span class="number">1</span>][tr[j][k]] &amp;&amp; (dp[i + <span class="number">1</span>][tr[j][k]] == dp[i][j] + val[tr[j][k]]));</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">string</span> res;</span><br><span class="line">        <span class="keyword">int</span> r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; e; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (ok[i + <span class="number">1</span>][tr[r][k]] &amp;&amp; dp[i + <span class="number">1</span>][tr[r][k]] == dp[i][r] + val[tr[r][k]])</span><br><span class="line">                &#123;</span><br><span class="line">                    res += k + <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">                    r = tr[r][k];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//cout &lt;&lt; ans &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">                tr[j][k] = <span class="number">0</span>;</span><br><span class="line">            val[j] = <span class="number">0</span>;</span><br><span class="line">            fail[j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        v.clear();</span><br><span class="line">        <span class="built_in">memset</span>(ok, <span class="number">0</span>, <span class="keyword">sizeof</span>(ok));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="CF-1163-D-Mysterious-Code-求权值">CF 1163 D  Mysterious Code 求权值</h3>
<p>https://codeforces.com/contest/1163/problem/D</p>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201124225402972.png" alt="image-20201124150910176" style="zoom: 33%;" />
<ul>
<li>
<p>题意</p>
<p>给两个模式串<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">s,t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span></span></span></span>, 修改字符串 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span>. 使得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(c&#x27;,s) - f(c&#x27;,t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span> 最大.</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 中出现的次数</p>
</li>
<li>
<p>分析</p>
<p>其实只有两个串, 不用ac自动机, 开两维的kmp也能ac</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// ----------------check here before submitting your code--------------------------------</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QWQ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">8e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// -------------------------------------check here before submitting your code-----------</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">2e9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> INF64 = <span class="number">4e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG(qwq...) fprintf(stderr, qwq)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> debug(x) cerr &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot; = &quot;</span> &lt;&lt; x &lt;&lt; <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(x, y, z) for (int(x) = int(y); int(x) &lt;= int(z); x++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(x, y, z) for (int(x) = int(y); int(x) &gt;= int(z); x--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min3(x, y, z) min((x), min((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max3(x, y, z) max((x), max((y), (z)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cb complex<span class="meta-string">&lt;double&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x) ((-(x)) &amp; (x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msz(a) memset(a, 0, sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> msm(a) memset(a, -1, sizeof(a))</span></span><br><span class="line"><span class="comment">//const int g1 = 3;</span></span><br><span class="line"><span class="comment">//const int g2 = 332748118;</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setmin</span><span class="params">(T &amp;a, T b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &lt; a)</span><br><span class="line">        a = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setmax</span><span class="params">(T &amp;a, T b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt; a)</span><br><span class="line">        a = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">custom_hash</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">uint64_t</span> <span class="title">splitmix64</span><span class="params">(<span class="keyword">uint64_t</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// http://xorshift.di.unimi.it/splitmix64.c</span></span><br><span class="line">        x += <span class="number">0x9e3779b97f4a7c15</span>;</span><br><span class="line">        x = (x ^ (x &gt;&gt; <span class="number">30</span>)) * <span class="number">0xbf58476d1ce4e5b9</span>;</span><br><span class="line">        x = (x ^ (x &gt;&gt; <span class="number">27</span>)) * <span class="number">0x94d049bb133111eb</span>;</span><br><span class="line">        <span class="keyword">return</span> x ^ (x &gt;&gt; <span class="number">31</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">uint64_t</span> x)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint64_t</span> FIXED_RANDOM = chrono::steady_clock::now().time_since_epoch().count();</span><br><span class="line">        <span class="keyword">return</span> splitmix64(x + FIXED_RANDOM);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">int</span>, custom_hash&gt; safe_map;</span><br><span class="line">gp_hash_table&lt;<span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">int</span>, custom_hash&gt; safe_hash_table;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1ll</span> * x * y % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> ((x + y) % mod + mod) % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> ((x - y) % mod + mod) % mod; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ans = mul(ans, a);</span><br><span class="line">        a = mul(a, a);</span><br><span class="line">        b /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> trie[maxn][<span class="number">30</span>], fail[maxn];</span><br><span class="line">    <span class="keyword">int</span> sz[maxn];</span><br><span class="line">    <span class="keyword">int</span> vis[maxn];         <span class="comment">// 结点经过次数</span></span><br><span class="line">    <span class="keyword">int</span> MP[maxn];          <span class="comment">// 模式串相同时用的映射</span></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>, csz = <span class="number">30</span>; <span class="comment">// 字典树结点号;字符集大小</span></span><br><span class="line">    <span class="keyword">int</span> in[maxn];          <span class="comment">// topu用的入度</span></span><br><span class="line"></span><br><span class="line">    AC()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// msz(trie);</span></span><br><span class="line">        <span class="comment">// msz(fail);</span></span><br><span class="line">        <span class="comment">// msz(sz);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        fill(fail, fail + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(sz, sz + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        fill(vis, vis + cnt + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) rep(j, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            trie[i][j] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ctn</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_node</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) trie[cnt][i] = <span class="number">0</span>;</span><br><span class="line">        sz[cnt] = fail[cnt] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> &amp;s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            <span class="keyword">if</span> (!trie[root][p])</span><br><span class="line">                trie[root][p] = get_node();</span><br><span class="line">            root = trie[root][p];</span><br><span class="line">        &#125;</span><br><span class="line">        sz[root] += id;</span><br><span class="line">        MP[id] = sz[root]; <span class="comment">//叶结点个数增加.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">0</span>, csz - <span class="number">1</span>) <span class="keyword">if</span> (trie[<span class="number">0</span>][i])</span><br><span class="line">            q.push(trie[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            rep(i, <span class="number">0</span>, csz - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> &amp;v = trie[u][i];</span><br><span class="line">                <span class="keyword">if</span> (v)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail[v] = trie[fail[u]][i];</span><br><span class="line">                    q.push(v);</span><br><span class="line">                    sz[v] += sz[fail[v]];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    v = trie[fail[u]][i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> &amp;s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        rep(i, <span class="number">0</span>, s.size() - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> p = ctn(s[i]);</span><br><span class="line">            u = trie[u][p];</span><br><span class="line">            vis[u]++;</span><br><span class="line">            <span class="comment">// for (int v = u; v; v = fail[v])</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     for (auto to : sz[v])</span></span><br><span class="line">            <span class="comment">//         vis[to]++;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">topu</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        rep(i, <span class="number">1</span>, cnt) <span class="keyword">if</span> (!in[i])</span><br><span class="line">            q.push(i);</span><br><span class="line">        <span class="keyword">while</span> (!q.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> u = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            vis[fail[u]] += vis[u];</span><br><span class="line">            in[fail[u]]--;</span><br><span class="line">            <span class="keyword">if</span> (!in[fail[u]])</span><br><span class="line">                q.push(fail[u]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ll dp[maxn][maxn];</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------------functions-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    <span class="comment">//freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;out.txt&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    <span class="keyword">int</span> st_cl = clock();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> QWQ</span></span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> c;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; c;</span><br><span class="line">    <span class="built_in">string</span> s, t;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    rep(i, <span class="number">0</span>, c.size()) rep(j, <span class="number">0</span>, maxn - <span class="number">1</span>)</span><br><span class="line">        dp[i][j] = -INF64;</span><br><span class="line"></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    AC ac;</span><br><span class="line">    ac.insert(s, <span class="number">1</span>);</span><br><span class="line">    ac.insert(t, <span class="number">-1</span>);</span><br><span class="line">    ac.build_fail();</span><br><span class="line">    rep(i, <span class="number">0</span>, c.size() - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        rep(j, <span class="number">0</span>, ac.cnt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (c[i] == <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rep(k, <span class="number">0</span>, ac.csz - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> v = ac.trie[j][k];</span><br><span class="line">                    setmax(dp[i + <span class="number">1</span>][v], dp[i][j] + ac.sz[v]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> v = ac.trie[j][c[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                setmax(dp[i + <span class="number">1</span>][v], dp[i][j] + ac.sz[v]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ll res = -INF64;</span><br><span class="line">    rep(j, <span class="number">0</span>, ac.cnt)</span><br><span class="line">        setmax(res, dp[c.size()][j]);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> QWQ</span></span><br><span class="line">    LOG(<span class="string">&quot;Time: %dms\n&quot;</span>, <span class="keyword">int</span>((clock() - st_cl) / (<span class="keyword">double</span>)CLOCKS_PER_SEC * <span class="number">1000</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HDU-2825-Wireless-Password-至少有k个关键字符串的方案-状压">HDU 2825 Wireless Password    至少有k个关键字符串的方案 状压</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201124152354245.png" alt="image-20201124152354245" style="zoom:80%;" />
<ul>
<li>
<p>分析</p>
<p>这里只统计每个串出现与否, 不关心具体出现次数.</p>
<p>所以dp的时候得记录一下之前选了哪些串.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>01001</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][j][01001]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span></p>
<p>表示长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>, ac结点是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>, 然后第三维表示选了哪些.</p>
<p>这样<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">ac</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span> 自动机上面统计的时候应该是fail的或.</p>
<p>一直T.</p>
<p><strong>优化</strong>:</p>
<p>​	dp值为0的点对后面没有贡献, 可以直接跳过.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">20090717</span>;</span><br><span class="line"><span class="keyword">int</span> tr[<span class="number">2005</span>][<span class="number">30</span>], fail[<span class="number">10005</span>];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> val[<span class="number">1</span> &lt;&lt; <span class="number">12</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">            tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>] = ++cnt;</span><br><span class="line">        root = tr[root][s[i] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    val[root] = <span class="number">1</span> &lt;&lt; id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> (tr[<span class="number">0</span>][i])</span><br><span class="line">            q.push(tr[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (tr[x][i])</span><br><span class="line">            &#123;</span><br><span class="line">                fail[tr[x][i]] = tr[fail[x]][i];</span><br><span class="line">                val[tr[x][i]] |= val[tr[fail[x]][i]];</span><br><span class="line">                q.push(tr[x][i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                tr[x][i] = tr[fail[x]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">27</span>][<span class="number">1200</span>][<span class="number">205</span>];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">15</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m, k;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;n, &amp;m, &amp;k) &amp;&amp; (n + m + k))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">            insert(s, i - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        bfs();</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> st = <span class="number">0</span>; st &lt; (<span class="number">1</span> &lt;&lt; m); st++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(dp[i][st][j] == <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">int</span> &amp;x = dp[i + <span class="number">1</span>][st | val[tr[j][k]]][tr[j][k]];</span><br><span class="line">                        x += dp[i][st][j];</span><br><span class="line">                        <span class="keyword">if</span> (x &gt;= mod)</span><br><span class="line">                            x -= mod;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> st = <span class="number">0</span>; st &lt; (<span class="number">1</span> &lt;&lt; m); st++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> x = st;</span><br><span class="line">            <span class="keyword">while</span> (x)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (x &amp; <span class="number">1</span>)</span><br><span class="line">                    num++;</span><br><span class="line">                x /= <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (num &lt; k)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                ans = (ans + dp[n][st][j]);</span><br><span class="line">                <span class="keyword">if</span> (ans &gt;= mod)</span><br><span class="line">                    ans -= mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> st = <span class="number">0</span>; st &lt; (<span class="number">1</span> &lt;&lt; m); st++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">                    dp[i][st][j] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= cnt; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; k++)</span><br><span class="line">                tr[j][k] = <span class="number">0</span>;</span><br><span class="line">            val[j] = <span class="number">0</span>;</span><br><span class="line">            fail[j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="POJ-2778-DNA-Sequence-矩阵快速幂优化">POJ 2778 <strong>DNA Sequence</strong> 矩阵快速幂优化</h3>
<p>http://poj.org/problem?id=2778</p>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20210513215708631.png" alt="image-20210513215708631" style="zoom:50%;" />
<h3 id="HDU-2243-矩阵快速幂优化">HDU 2243  矩阵快速幂优化</h3>
<img src= "/img/loading.gif" data-lazy-src="http://ding-typora.oss-cn-beijing.aliyuncs.com/img/image-20201124231830169.png" alt="image-20201124231830169" style="zoom:67%;" />
<ul>
<li>
<p>分析</p>
<p>上面做了这么多题, 可以发现ac自动机转移方程的特点是每一步转移其实都是一样的. 所以就可以表示成一个固定的矩阵的形式来优化.</p>
<p>这里要求至少一个, 那求出一个都没有, 拿总数减掉就行了.</p>
<p>哦, 然后这里是不超过<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>, 还要搞一个容斥转移.</p>
</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>m</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><msup><mi>m</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>m</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>−</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mi>v</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">  v(l + 1) = m * (v(l) - v(l - 1)) + v(l)
  \\ v(l + 2) = m * (v(l + 1) - v(l)) + v(l + 1) = m*( m * (v(l) - v(l - 1)) + v(l) - v(l)) + v(l + 1)
  \\ = m^2 (v(l) - v(l - 1)) + m * (v(l) - v(l - 1)) + v(l)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span></span></p>
<p>打住, 这样做是错的.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>​</p>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Sufjan%20Stevens_Carrie&amp;Lowell.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/ACM/%E5%AD%97%E7%AC%A6%E4%B8%B2/KMP/"><img class="prev-cover" data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Sebastian%20Plano_Impetus.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">KMP 和 扩展KMP</div></div></a></div><div class="next-post pull-right"><a href="/ACM/%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/ACM/%E5%9B%BE%E8%AE%BA/%E7%BD%91%E7%BB%9C%E6%B5%81/%E4%B8%8A%E4%B8%8B%E7%95%8C%E5%8F%AF%E8%A1%8C%E6%B5%81/"><img class="next-cover" data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/%E6%9B%BE%E8%BD%B6%E5%8F%AF_25%E5%B2%81%E7%9A%84%E6%99%B4%E5%92%8C%E9%9B%A8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网络流- 上下界可行流</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/qwq_circle2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">qwqbot</div><div class="author-info__description">CS-ACM-MUSIC-REANGDING-MOVIE</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pwqbot"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:974314484@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">AC自动机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-text">模式匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%9B%E8%B0%B7-ac%E8%87%AA%E5%8A%A8%E6%9C%BA%E6%A8%A1%E6%9D%BF"><span class="toc-text">洛谷 ac自动机模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3808"><span class="toc-text">P3808</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P3796"><span class="toc-text">P3796</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P5357"><span class="toc-text">P5357</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%9B%E8%B0%B7-P2444-POI2000-%E7%97%85%E6%AF%92trie%E6%A0%91%E4%B8%8A%E6%89%BE%E7%8E%AF"><span class="toc-text">洛谷 P2444 [POI2000]病毒	trie树上找环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF-1202-E-You-Are-Given-Some-Strings-%E7%BF%BB%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">CF 1202 E. You Are Given Some Strings...      翻转字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AC%E8%87%AA%E5%8A%A8%E6%9C%BAfail%E6%A0%91%E4%B8%8A%E5%BB%BA%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-text">AC自动机fail树上建可持久化线段树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%9B%E8%B0%B7-P2414-NOI2011-%E9%98%BF%E7%8B%B8%E7%9A%84%E6%89%93%E5%AD%97%E6%9C%BA-%E5%AD%97%E5%85%B8%E6%A0%91%E4%B8%8Adfs-fail%E6%A0%91%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">洛谷 P2414 [NOI2011] 阿狸的打字机       字典树上dfs+fail树区间查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%9B%E8%B0%B7-P5840-COCI2015-Divljak-dfs-lca-%E6%A0%91%E4%B8%8A%E5%B7%AE%E5%88%86"><span class="toc-text">洛谷 P5840 [COCI2015]Divljak     dfs+lca+树上差分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF163-E-e-Government-%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9"><span class="toc-text">CF163 E.e-Government      动态修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF547-E-Mike-and-Friends-%E7%A6%BB%E7%BA%BF-%E4%B8%BB%E5%B8%AD%E6%A0%91"><span class="toc-text">CF547 E.Mike and Friends     离线&#x2F;主席树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDU-2296-Ring-%E6%9E%84%E9%80%A0%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BE%97%E5%88%B0%E6%9C%80%E5%A4%A7%E6%9D%83%E5%80%BC"><span class="toc-text">HDU 2296 Ring   构造字符串得到最大权值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF-1163-D-Mysterious-Code-%E6%B1%82%E6%9D%83%E5%80%BC"><span class="toc-text">CF 1163 D  Mysterious Code 求权值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDU-2825-Wireless-Password-%E8%87%B3%E5%B0%91%E6%9C%89k%E4%B8%AA%E5%85%B3%E9%94%AE%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%96%B9%E6%A1%88-%E7%8A%B6%E5%8E%8B"><span class="toc-text">HDU 2825 Wireless Password    至少有k个关键字符串的方案 状压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJ-2778-DNA-Sequence-%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82%E4%BC%98%E5%8C%96"><span class="toc-text">POJ 2778 DNA Sequence 矩阵快速幂优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDU-2243-%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82%E4%BC%98%E5%8C%96"><span class="toc-text">HDU 2243  矩阵快速幂优化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最近更新</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%AE%9E%E9%AA%8C/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%AE%9E%E9%AA%8C/Lab4/" title="ucore - Lab4 内核进程管理"><img data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Snipaste_2021-05-02_20-52-58.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ucore - Lab4 内核进程管理"/></a><div class="content"><a class="title" href="/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%AE%9E%E9%AA%8C/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E5%AE%9E%E9%AA%8C/Lab4/" title="ucore - Lab4 内核进程管理">ucore - Lab4 内核进程管理</a><time datetime="2021-05-25T16:00:11.701Z" title="更新于 2021-05-26 00:00:11">2021-05-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ACM/ACM/%E5%B7%A5%E5%85%B7%E7%AE%B1/" title="工具箱"><img data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/%E4%B8%87%E8%83%BD%E9%9D%92%E5%B9%B4%E6%97%85%E5%BA%97_%E4%B8%87%E8%83%BD%E9%9D%92%E5%B9%B4%E6%97%85%E5%BA%97.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="工具箱"/></a><div class="content"><a class="title" href="/ACM/ACM/%E5%B7%A5%E5%85%B7%E7%AE%B1/" title="工具箱">工具箱</a><time datetime="2021-05-25T11:53:18.934Z" title="更新于 2021-05-25 19:53:18">2021-05-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E9%93%BE%E6%8E%A5/" title="无题"><img data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/%E5%91%8A%E4%BA%94%E4%BA%BA_%E6%88%91%E8%82%AF%E5%AE%9A%E5%9C%A8%E5%87%A0%E7%99%BE%E5%B9%B4%E5%89%8D%E5%B0%B1%E8%AF%B4%E8%BF%87%E7%88%B1%E4%BD%A0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/uncategorized/CS0804n/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E9%93%BE%E6%8E%A5/" title="无题">无题</a><time datetime="2021-05-25T07:35:06.000Z" title="更新于 2021-05-25 15:35:06">2021-05-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/CS0804n/CC++/AVL%E6%A0%91/" title="无题"><img data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/Manchester%20by%20the%20Sea.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/uncategorized/CS0804n/CC++/AVL%E6%A0%91/" title="无题">无题</a><time datetime="2021-05-22T06:14:47.000Z" title="更新于 2021-05-22 14:14:47">2021-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/CS0804n/CC/CS0804n/CC++/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/" title="无题"><img data-lazy-src="https://ding-typora.oss-cn-beijing.aliyuncs.com/img/James%20Blake_Are%20you%20even%20Real.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/CS0804n/CC/CS0804n/CC++/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/" title="无题">无题</a><time datetime="2021-05-22T05:53:53.000Z" title="更新于 2021-05-22 13:53:53">2021-05-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 By qwqbot</div><div class="footer_custom_text">福禄寿伴你左右</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', '', 'katex-wrap')
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>